C51 COMPILER V9.54   MAIN                                                                  12/26/2022 19:46:21 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "STC15F2K60S2.H"
   2          #include "INTRINS.H"
   3          #include "IIC.H"
   4          
   5          char tik8ms; //Ê±¼ä±êÖ¾Î»
   6          char smg[8];// ÓÃÀ´´æ´¢Ã¿¸öÊýÂë¹ÜÏÔÊ¾µÄ¶«Î÷£¨¾ßÌåÏÔÊ¾Ê²Ã´²Î¿¼Êý×ét_display£©
   7          
   8          unsigned int voltage; //´æ´¢ADC²É¼¯µÄµçÑ¹ÊýÖµ
   9          
  10          //ÏÂÃæÁ½¸ö±äÁ¿²»ÓÃ¼ÇÒä¿ÉÒÔ´ÓSTC¡ªISPÈí¼þÖÐ»ñÈ¡£¨ÓÒÉÏ½Ç±ßÀ¸µÄ -> STC¿ª·¢°å£¨ÊÔÑéÏä4Ê¾Àý³ÌÐò£©-> H595Çý¶¯ÊýÂ
             -ë¹Ü ¡ª> C£©
  11          
  12          /*************  ±¾µØ³£Á¿ÉùÃ÷    **************/
  13          char t_display[]={                       //±ê×¼×Ö¿â
  14          //   0    1    2    3    4    5    6    7    8    9    A    B    C    D    E    F
  15              0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,0x7F,0x6F,0x77,0x7C,0x39,0x5E,0x79,0x71,
  16          //black  -     H    J    K    L    N    o   P    U     t    G    Q    r   M    y
  17              0x00,0x40,0x76,0x1E,0x70,0x38,0x37,0x5C,0x73,0x3E,0x78,0x3d,0x67,0x50,0x37,0x6e,
  18              0xBF,0x86,0xDB,0xCF,0xE6,0xED,0xFD,0x87,0xFF,0xEF,0x46};    //0. 1. 2. 3. 4. 5. 6. 7. 8. 9. -1
  19          
  20          char T_COM[]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80}; //Î»Âë
  21          
  22          
  23          
  24          
  25          //¶¨Ê±Æ÷ÅäÖÃ¿ÉÒÔ´ÓSTC¡ªISPÈí¼þÖÐµÄ¶¨Ê±Æ÷¼ÆËãÆ÷ÖÐ»ñµÃ £¨1ms 16Î»×Ô¶¯ÖØÔØ 1TÖ¸Áî¼¯£©
  26          //×¢Òâ×îºóÁ½ÐÐÐèÒª×ÔÐÐÌí¼Ó£¨  ET1 = 1; EA = 1;£©
  27          void Timer1Init(void)   //1ºÁÃë@12.000MHz
  28          {
  29   1        AUXR |= 0x40;   //¶¨Ê±Æ÷Ê±ÖÓ1TÄ£Ê½
  30   1        TMOD &= 0x0F;   //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
  31   1        TL1 = 0x20;   //ÉèÖÃ¶¨Ê±³õÖµ
  32   1        TH1 = 0xD1;   //ÉèÖÃ¶¨Ê±³õÖµ
  33   1        TF1 = 0;    //Çå³ýTF1±êÖ¾
  34   1        TR1 = 1;    //¶¨Ê±Æ÷1¿ªÊ¼¼ÆÊ±
  35   1        ET1 = 1;                           //´ò¿ª¶¨Ê±Æ÷Ò»£¨ÐèÒª×ÔÐÐÌí¼Ó£©
  36   1        EA = 1;                            //´ò¿ªÖÐ¶Ï¿ª¹Ø£¨ÐèÒª×ÔÐÐÌí¼Ó£©
  37   1      }
  38          
  39          //ÊýÂë¹ÜÏÔÊ¾µ¥Ôª
  40          void SMG(char wei,char number)
  41          {
  42   1      P2=0XC0;P0=T_COM[wei];P2=0X00; //¶ÎÑ¡ 
  43   1      P2=0XE0;P0=~t_display[number];P2=0X00;//Î»Ñ¡£¨×¢ÒâSTCÌá¹©µÄÊÇ¹²ÒõÂëÊ¹ÓÃÊ±×¢ÒâÈ¡·´£©
  44   1      P0=0X00; //Ïû³ý¹íÓ°½¨Òé¼ÓÉÏ
  45   1      }
  46          
  47          //100ºÁÃëÑÓÊ±
  48          void Delay100ms()   //@12.000MHz
  49          {
  50   1        unsigned char i, j, k;
  51   1      
  52   1        _nop_();
  53   1        _nop_();
C51 COMPILER V9.54   MAIN                                                                  12/26/2022 19:46:21 PAGE 2   

  54   1        i = 5;
  55   1        j = 144;
  56   1        k = 71;
  57   1        do
  58   1        {
  59   2          do
  60   2          {
  61   3            while (--k);
  62   3          } while (--j);
  63   2        } while (--i);
  64   1      }
  65          
  66          int main ()
  67          {
  68   1      P2=0XE0;P0=0X00;P2=0X00;//¹Ø±Õ·äÃùÆ÷
  69   1      P2=0X80;P0=0XFF;P2=0X00;//¹Ø±ÕLED
  70   1      Timer1Init();//¶¨Ê±Æ÷Ò»³õÊ¼»¯
  71   1      while(1)
  72   1      {
  73   2      
  74   2      //ÏÔÊ¾ADC²É¼¯µÄµçÑ¹
  75   2      smg[0]=voltage/1000;
  76   2      smg[1]=voltage%1000/100;
  77   2      smg[2]=voltage%100/10;
  78   2      smg[3]=voltage%10;
  79   2        
  80   2      smg[4]=16;smg[5]=16;smg[6]=16;smg[7]=16;  
  81   2      
  82   2      Delay100ms(); //ÑÓÊ±·ÀÖ¹¶ÁÈ¡¹ý¿ìÓ°ÏìÏÔÊ¾
  83   2      voltage=adc(0x03);//Ã¿¶þÊ®ºÁÃë¶ÁÒ»´ÎÊý¾Ý   adc(0x03)*5/255
  84   2        
  85   2      dac(255);//ÊäÈë·¶Î§x£¨0-255£©Êä³öµçÑ¹y£¨0-5V£©¸ù¾Ý¾ßÌåÇé¿ö¿´ÄãµÄ°å×ÓµçÑ¹
  86   2      }
  87   1      }
  88          
  89          
  90          void server ()interrupt 3  //¶¨Ê±Æ÷1·þÎñº¯ÊýÃû×Ö¿ÉËæÒâµ«ÊÇºóÃæÒ»¶¨Òª¼Ó interrupt 3£¨ÓÉÓÚÅäÖÃµÄ1ms£¬¼´Ã¿Ò»º
             -ÁÃë¾Í»á½øÈë´Ë·þÎñº¯Êý£©
  91          {
  92   1      tik8ms=tik8ms+1;   //ÈÃÆäÃ¿Ò»ºÁÃë×ÔÔöÒ»
  93   1      if(tik8ms==8)tik8ms=0; //ÏÞ¶¨ÆäÔÚ0-7Ñ­»·
  94   1      SMG(tik8ms,smg[tik8ms]); //Öð¸öË¢ÐÂÊýÂë¹Ü 
  95   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    241    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     62    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
